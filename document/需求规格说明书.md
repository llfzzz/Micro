# Micro 社交平台 - 需求规格说明书

**文档版本**: v1.0  
**编制日期**: 2025年12月18日  
**项目名称**: Micro  
**项目类型**: Java Web 社交媒体平台

---

## 目录

1. [项目概述](#1-项目概述)
2. [系统架构](#2-系统架构)
3. [技术栈规范](#3-技术栈规范)
4. [数据模型设计](#4-数据模型设计)
5. [功能需求规格](#5-功能需求规格)
6. [接口规范](#6-接口规范)
7. [前端页面规范](#7-前端页面规范)
8. [安全规范](#8-安全规范)
9. [性能要求](#9-性能要求)
10. [部署规范](#10-部署规范)

---

## 1. 项目概述

### 1.1 项目定位

Micro 是一个基于 Java Web 技术栈开发的轻量级社交平台，提供用户注册登录、动态发布、社交互动、关注关系管理及后台管理等核心功能。

### 1.2 项目目标

- 实现完整的社交媒体核心功能闭环
- 采用传统 MVC 分层架构，结构清晰可维护
- 前后端分离的 API 设计，支持 RESTful 接口
- 支持多媒体内容（图片、视频）的上传与展示
- 提供管理后台进行内容审核与用户管理

### 1.3 用户角色

| 角色 | 标识 | 权限说明 |
|------|------|----------|
| 普通用户 | USER | 注册登录、发布动态、评论点赞、关注用户、编辑个人资料 |
| 管理员 | ADMIN | 包含普通用户全部权限，额外支持：用户管理、内容审核、数据统计 |

---

## 2. 系统架构

### 2.1 整体架构

```
┌─────────────────────────────────────────────────────────────┐
│                        客户端层                              │
│              (浏览器 / JSP + JavaScript)                     │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                        表现层 (Servlet)                      │
│  ┌──────────┬──────────┬──────────┬──────────┬──────────┐  │
│  │AuthServlet│PostServlet│UserServlet│FollowServlet│AdminServlet│  │
│  └──────────┴──────────┴──────────┴──────────┴──────────┘  │
│  ┌──────────┬──────────┬──────────┐                        │
│  │CommentServlet│MediaServlet│PageServlet│                      │
│  └──────────┴──────────┴──────────┘                        │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                        业务逻辑层 (Service)                   │
│  ┌──────────┬──────────┬──────────┬──────────┐             │
│  │AuthService│PostService│UserService│FollowService│             │
│  └──────────┴──────────┴──────────┴──────────┘             │
│  ┌──────────┬──────────┬──────────┐                        │
│  │CommentService│MediaService│AdminService│                      │
│  └──────────┴──────────┴──────────┘                        │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                        数据访问层 (DAO)                       │
│  ┌──────────┬──────────┬──────────┬──────────┐             │
│  │ UserDao  │ PostDao  │CommentDao│ LikeDao  │             │
│  └──────────┴──────────┴──────────┴──────────┘             │
│  ┌──────────┬──────────┐                                   │
│  │FollowDao │ MediaDao │                                   │
│  └──────────┴──────────┘                                   │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                        数据存储层                            │
│            MySQL 数据库 + 文件系统存储                        │
└─────────────────────────────────────────────────────────────┘
```

### 2.2 模块划分

| 模块名称 | 包路径 | 职责描述 |
|---------|--------|----------|
| Entity | com.micro.entity | 数据实体类定义 |
| DAO | com.micro.dao | 数据访问接口与实现 |
| Service | com.micro.service | 业务逻辑处理 |
| Servlet | com.micro.servlet | HTTP 请求处理与路由 |
| Filter | com.micro.filter | 请求过滤与拦截 |
| Listener | com.micro.listener | 应用生命周期管理 |
| Util | com.micro.util | 通用工具类 |
| Exception | com.micro.exception | 自定义异常类 |

---

## 3. 技术栈规范

### 3.1 后端技术

| 技术组件 | 版本要求 | 用途说明 |
|---------|---------|----------|
| Java | 17+ | 核心运行环境 |
| Servlet API | 4.0 | Web 请求处理 |
| JSP + JSTL | 2.3 | 服务端页面渲染 |
| MySQL | 8.0+ | 关系型数据库 |
| HikariCP | - | 数据库连接池 |
| Jackson | - | JSON 序列化处理 |
| BCrypt | - | 密码加密 |
| SLF4J + Logback | - | 日志框架 |

### 3.2 前端技术

| 技术组件 | 用途说明 |
|---------|----------|
| JSP + CSS3 | 页面结构与样式 |
| Vanilla JavaScript | 交互逻辑（无框架依赖） |
| Fetch API | 异步接口调用 |

### 3.3 构建工具

| 工具 | 用途说明 |
|------|----------|
| Maven | 项目构建与依赖管理 |
| Tomcat | Servlet 容器 |

---

## 4. 数据模型设计

### 4.1 实体关系图

```
┌─────────────┐       ┌─────────────┐       ┌─────────────┐
│   users     │───1:N─│    posts    │───1:N─│  comments   │
└─────────────┘       └─────────────┘       └─────────────┘
       │                     │
       │                     │
       │              ┌──────┴──────┐
       │              │             │
       │         ┌────┴────┐  ┌─────┴─────┐
       │         │  likes  │  │   media   │
       │         └─────────┘  └───────────┘
       │
  ┌────┴────┐
  │ follows │
  └─────────┘
```

### 4.2 数据表结构

#### 4.2.1 用户表 (users)

| 字段名 | 数据类型 | 约束 | 说明 |
|--------|---------|------|------|
| id | BIGINT | PRIMARY KEY, AUTO_INCREMENT | 用户唯一标识 |
| username | VARCHAR(50) | NOT NULL, UNIQUE | 用户名（登录名） |
| email | VARCHAR(100) | - | 邮箱地址 |
| password_hash | VARCHAR(255) | NOT NULL | BCrypt 加密密码 |
| display_name | VARCHAR(100) | - | 显示昵称 |
| bio | VARCHAR(500) | - | 个人简介 |
| avatar_path | VARCHAR(255) | - | 头像文件路径 |
| banner_path | VARCHAR(255) | - | 背景图路径 |
| role | ENUM('USER','ADMIN') | DEFAULT 'USER' | 用户角色 |
| is_banned | TINYINT | DEFAULT 0 | 封禁状态 |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | 注册时间 |
| updated_at | TIMESTAMP | ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

#### 4.2.2 动态表 (posts)

| 字段名 | 数据类型 | 约束 | 说明 |
|--------|---------|------|------|
| id | BIGINT | PRIMARY KEY, AUTO_INCREMENT | 动态唯一标识 |
| user_id | BIGINT | NOT NULL, FOREIGN KEY | 发布者 ID |
| content_text | TEXT | - | 文字内容 |
| media_meta | TEXT | - | 媒体元数据 (JSON 格式) |
| link_url | VARCHAR(2048) | - | 外链 URL |
| visibility | ENUM('PUBLIC','PRIVATE','FRIENDS') | DEFAULT 'PUBLIC' | 可见性 |
| like_count | INT | DEFAULT 0 | 点赞数（冗余计数） |
| comment_count | INT | DEFAULT 0 | 评论数（冗余计数） |
| forward_count | INT | DEFAULT 0 | 转发数（冗余计数） |
| is_deleted | TINYINT | DEFAULT 0 | 软删除标记 |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | 发布时间 |
| updated_at | TIMESTAMP | ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

#### 4.2.3 评论表 (comments)

| 字段名 | 数据类型 | 约束 | 说明 |
|--------|---------|------|------|
| id | BIGINT | PRIMARY KEY, AUTO_INCREMENT | 评论唯一标识 |
| post_id | BIGINT | NOT NULL, FOREIGN KEY | 所属动态 ID |
| user_id | BIGINT | NOT NULL, FOREIGN KEY | 评论者 ID |
| parent_comment_id | BIGINT | - | 父评论 ID（支持嵌套回复） |
| content | TEXT | - | 评论内容 |
| is_deleted | TINYINT | DEFAULT 0 | 软删除标记 |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | 评论时间 |

#### 4.2.4 点赞表 (likes)

| 字段名 | 数据类型 | 约束 | 说明 |
|--------|---------|------|------|
| id | BIGINT | PRIMARY KEY, AUTO_INCREMENT | 点赞记录标识 |
| post_id | BIGINT | NOT NULL, FOREIGN KEY | 目标动态 ID |
| user_id | BIGINT | NOT NULL, FOREIGN KEY | 点赞用户 ID |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | 点赞时间 |

**唯一约束**: (post_id, user_id) 组合唯一

#### 4.2.5 关注表 (follows)

| 字段名 | 数据类型 | 约束 | 说明 |
|--------|---------|------|------|
| id | BIGINT | PRIMARY KEY, AUTO_INCREMENT | 关注记录标识 |
| follower_id | BIGINT | NOT NULL, FOREIGN KEY | 关注者 ID |
| followee_id | BIGINT | NOT NULL, FOREIGN KEY | 被关注者 ID |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | 关注时间 |

**唯一约束**: (follower_id, followee_id) 组合唯一

#### 4.2.6 媒体表 (media)

| 字段名 | 数据类型 | 约束 | 说明 |
|--------|---------|------|------|
| id | BIGINT | PRIMARY KEY, AUTO_INCREMENT | 媒体文件标识 |
| post_id | BIGINT | FOREIGN KEY | 关联动态 ID |
| uploader_id | BIGINT | FOREIGN KEY | 上传者 ID |
| type | ENUM('IMAGE','VIDEO','OTHER') | - | 媒体类型 |
| path | VARCHAR(1024) | NOT NULL | 文件存储路径 |
| original_name | VARCHAR(255) | - | 原始文件名 |
| width | INT | - | 媒体宽度（像素） |
| height | INT | - | 媒体高度（像素） |
| size | BIGINT | - | 文件大小（字节） |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | 上传时间 |

---

## 5. 功能需求规格

### 5.1 用户认证模块

#### 5.1.1 用户注册

**功能标识**: AUTH-REG-001

**功能描述**: 新用户通过提供用户名、密码等信息完成账户注册

**输入参数**:
| 参数名 | 类型 | 必填 | 校验规则 |
|--------|------|------|----------|
| username | String | 是 | 1-50 字符，唯一，不可重复 |
| password | String | 是 | 最少 6 字符 |
| email | String | 否 | 符合邮箱格式 |
| displayName | String | 否 | 1-100 字符 |

**处理逻辑**:
1. 校验用户名是否已存在
2. 对密码进行 BCrypt 加密（工作因子可配置，默认 12）
3. 创建用户记录，角色默认为 USER
4. 自动登录并建立 Session

**输出结果**: 用户基本信息（不含密码）

#### 5.1.2 用户登录

**功能标识**: AUTH-LOGIN-002

**功能描述**: 已注册用户通过用户名/邮箱和密码进行身份验证

**输入参数**:
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| identifier | String | 是 | 用户名或邮箱 |
| password | String | 是 | 登录密码 |

**处理逻辑**:
1. 根据标识符查询用户（支持用户名和邮箱两种方式）
2. 校验用户是否被封禁
3. 验证密码正确性
4. 创建 Session 并存储 userId 和 role

**输出结果**: 用户基本信息

#### 5.1.3 用户登出

**功能标识**: AUTH-LOGOUT-003

**功能描述**: 注销当前登录状态

**处理逻辑**: 销毁当前 Session

---

### 5.2 动态管理模块

#### 5.2.1 发布动态

**功能标识**: POST-CREATE-001

**功能描述**: 用户发布包含文字、图片或视频的动态内容

**前置条件**: 用户已登录

**输入参数**:
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| contentText | String | 否 | 文字内容（支持 #话题 和 @提及） |
| mediaMetaJson | String | 否 | 媒体文件元数据（JSON 数组） |
| visibility | String | 否 | 可见性：PUBLIC/PRIVATE/FRIENDS |

**处理逻辑**:
1. 校验用户登录状态
2. 解析并验证媒体元数据格式
3. 创建动态记录
4. 绑定已上传的媒体文件

**输出结果**: 新创建的动态信息

#### 5.2.2 获取动态流

**功能标识**: POST-FEED-002

**功能描述**: 获取公开动态的时间线列表

**输入参数**:
| 参数名 | 类型 | 默认值 | 说明 |
|--------|------|--------|------|
| offset | Integer | 0 | 分页偏移量 |
| limit | Integer | 20 | 单页数量（最大 50） |
| userId | Long | - | 可选，指定用户的动态 |

**处理逻辑**:
1. 查询未删除的公开动态
2. 按创建时间倒序排列
3. 关联查询用户信息
4. 若当前用户已登录，标记点赞状态

**输出结果**: 动态列表及分页信息

#### 5.2.3 获取动态详情

**功能标识**: POST-DETAIL-003

**功能描述**: 获取单条动态的完整信息

**输入参数**:
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| id | Long | 是 | 动态 ID |

**输出结果**: 动态详情（含作者信息、媒体列表）

#### 5.2.4 删除动态

**功能标识**: POST-DELETE-004

**功能描述**: 用户删除自己发布的动态

**前置条件**: 用户已登录，且为动态作者

**处理逻辑**:
1. 校验操作者权限
2. 执行软删除（设置 is_deleted = 1）

#### 5.2.5 点赞/取消点赞

**功能标识**: POST-LIKE-005

**功能描述**: 对动态进行点赞或取消点赞操作

**前置条件**: 用户已登录

**处理逻辑**:
1. 检查当前点赞状态
2. 若已点赞则取消，否则添加点赞
3. 更新动态的 like_count 计数

**输出结果**: 操作后的点赞状态及最新计数

---

### 5.3 评论管理模块

#### 5.3.1 发表评论

**功能标识**: COMMENT-CREATE-001

**功能描述**: 对动态发表评论

**前置条件**: 用户已登录

**输入参数**:
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| postId | Long | 是 | 目标动态 ID |
| content | String | 是 | 评论内容 |
| parentCommentId | Long | 否 | 父评论 ID（用于回复） |

**处理逻辑**:
1. 创建评论记录
2. 更新动态的 comment_count 计数

#### 5.3.2 获取评论列表

**功能标识**: COMMENT-LIST-002

**功能描述**: 获取指定动态的评论列表

**输入参数**:
| 参数名 | 类型 | 默认值 | 说明 |
|--------|------|--------|------|
| postId | Long | - | 目标动态 ID |
| offset | Integer | 0 | 分页偏移量 |
| limit | Integer | 20 | 单页数量 |

**输出结果**: 评论列表（含评论者信息）

---

### 5.4 关注关系模块

#### 5.4.1 关注用户

**功能标识**: FOLLOW-ADD-001

**功能描述**: 关注指定用户

**前置条件**: 用户已登录

**输入参数**:
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| targetUserId | Long | 是 | 被关注用户 ID |

**业务规则**:
- 不能关注自己
- 重复关注无效

#### 5.4.2 取消关注

**功能标识**: FOLLOW-REMOVE-002

**功能描述**: 取消对指定用户的关注

**前置条件**: 用户已登录

#### 5.4.3 获取关注统计

**功能标识**: FOLLOW-STATS-003

**功能描述**: 获取用户的粉丝数和关注数

**输出结果**:
| 字段 | 说明 |
|------|------|
| followers | 粉丝数量 |
| following | 关注数量 |
| followingState | 当前用户是否关注该用户 |

#### 5.4.4 获取关注/粉丝列表

**功能标识**: FOLLOW-LIST-004

**功能描述**: 获取用户的关注列表或粉丝列表

**输入参数**:
| 参数名 | 类型 | 说明 |
|--------|------|------|
| type | String | followers 或 following |
| offset | Integer | 分页偏移量 |
| limit | Integer | 单页数量（最大 50） |

---

### 5.5 用户资料模块

#### 5.5.1 获取用户信息

**功能标识**: USER-PROFILE-001

**功能描述**: 获取用户公开资料

**输入参数**:
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| userId | Long | 是 | 目标用户 ID |

**输出结果**: 用户资料（不含敏感信息）

#### 5.5.2 更新个人资料

**功能标识**: USER-UPDATE-002

**功能描述**: 修改当前登录用户的个人资料

**前置条件**: 用户已登录

**可修改字段**:
- displayName（显示昵称）
- bio（个人简介）
- email（邮箱）

#### 5.5.3 上传头像/背景图

**功能标识**: USER-AVATAR-003

**功能描述**: 上传或更新用户头像和背景图片

**前置条件**: 用户已登录

**文件限制**:
- 支持格式：image/jpeg、image/png、image/gif
- 最大文件大小：5MB

---

### 5.6 媒体文件模块

#### 5.6.1 文件上传

**功能标识**: MEDIA-UPLOAD-001

**功能描述**: 上传图片或视频文件

**前置条件**: 用户已登录

**输入参数**:
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| file | MultipartFile | 是 | 上传的文件 |

**文件限制**:
- 支持类型：image/*、video/*
- 最大单文件：100MB
- 最大请求：200MB

**处理逻辑**:
1. 校验文件类型和大小
2. 生成唯一文件名（年/月/UUID 目录结构）
3. 保存到文件系统
4. 创建媒体记录

**输出结果**: 媒体 ID、访问路径、类型、大小

---

### 5.7 搜索模块

#### 5.7.1 搜索用户

**功能标识**: SEARCH-USER-001

**功能描述**: 根据关键字搜索用户

**输入参数**:
| 参数名 | 类型 | 说明 |
|--------|------|------|
| q | String | 搜索关键字 |
| limit | Integer | 结果数量上限 |

**搜索范围**: 用户名、显示昵称

#### 5.7.2 搜索话题标签

**功能标识**: SEARCH-TAG-002

**功能描述**: 搜索动态中的话题标签

**输入参数**:
| 参数名 | 类型 | 说明 |
|--------|------|------|
| q | String | 标签前缀 |

**输出结果**: 匹配的话题标签列表

---

### 5.8 管理后台模块

#### 5.8.1 数据统计

**功能标识**: ADMIN-STATS-001

**功能描述**: 获取平台整体数据统计

**前置条件**: 管理员权限

**输出结果**:
| 字段 | 说明 |
|------|------|
| users | 总用户数 |
| posts | 总动态数 |
| comments | 总评论数 |

#### 5.8.2 用户管理

**功能标识**: ADMIN-USER-002

**功能描述**: 查询和管理平台用户

**前置条件**: 管理员权限

**支持操作**:
- 分页查询用户列表
- 按关键字、角色、封禁状态筛选
- 封禁/解封用户

#### 5.8.3 内容审核

**功能标识**: ADMIN-CONTENT-003

**功能描述**: 审核和管理平台内容

**前置条件**: 管理员权限

**支持操作**:
- 查询动态列表（可按用户、关键字、可见性、删除状态筛选）
- 强制删除动态
- 删除评论

---

## 6. 接口规范

### 6.1 通用规范

#### 6.1.1 请求格式

- Content-Type: application/json
- 认证方式: Session Cookie

#### 6.1.2 响应格式

**成功响应**:
```json
{
  "success": true,
  "data": { ... }
}
```

**失败响应**:
```json
{
  "success": false,
  "error": {
    "code": 4001,
    "message": "错误描述"
  }
}
```

#### 6.1.3 HTTP 状态码

| 状态码 | 含义 |
|--------|------|
| 200 | 请求成功 |
| 400 | 请求参数错误 |
| 401 | 未认证（需要登录） |
| 403 | 无权限 |
| 404 | 资源不存在 |
| 500 | 服务器内部错误 |

### 6.2 接口列表

#### 6.2.1 认证接口

| 方法 | 路径 | 说明 |
|------|------|------|
| POST | /api/auth/register | 用户注册 |
| POST | /api/auth/login | 用户登录 |
| POST | /api/auth/logout | 用户登出 |

#### 6.2.2 动态接口

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /api/posts | 获取动态流 |
| GET | /api/posts/{id} | 获取动态详情 |
| POST | /api/posts | 发布动态 |
| DELETE | /api/posts/{id} | 删除动态 |
| POST | /api/posts/{id}/like | 点赞/取消点赞 |
| GET | /api/posts/tags | 搜索话题标签 |

#### 6.2.3 评论接口

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /api/comments | 获取评论列表 |
| POST | /api/comments | 发表评论 |

#### 6.2.4 用户接口

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /api/users | 搜索用户 |
| GET | /api/users/{id} | 获取用户信息 |
| PUT | /api/users/{id} | 更新用户资料 |
| GET | /api/users/{id}/avatar | 获取用户头像 |
| POST | /api/users/{id}/avatar | 上传用户头像 |
| GET | /api/users/{id}/banner | 获取背景图 |
| POST | /api/users/{id}/banner | 上传背景图 |

#### 6.2.5 关注接口

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /api/follows/{userId} | 获取关注统计 |
| GET | /api/follows/{userId}/followers | 获取粉丝列表 |
| GET | /api/follows/{userId}/following | 获取关注列表 |
| POST | /api/follows/{userId} | 关注用户 |
| DELETE | /api/follows/{userId} | 取消关注 |

#### 6.2.6 上传接口

| 方法 | 路径 | 说明 |
|------|------|------|
| POST | /api/upload | 上传媒体文件 |

#### 6.2.7 管理接口

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /api/admin/stats | 获取统计数据 |
| GET | /api/admin/users | 查询用户列表 |
| POST | /api/admin/users/{id}/ban | 封禁/解封用户 |
| GET | /api/admin/posts | 查询动态列表 |
| DELETE | /api/admin/posts/{id} | 删除动态 |
| DELETE | /api/admin/comments/{id} | 删除评论 |

---

## 7. 前端页面规范

### 7.1 页面路由

| 路径 | 页面 | 说明 |
|------|------|------|
| /app/feed | feed.jsp | 首页动态流 |
| /app/login | login.jsp | 登录页面 |
| /app/register | register.jsp | 注册页面 |
| /app/post | post.jsp | 动态详情页 |
| /app/profile | profile.jsp | 用户主页 |
| /app/profile/edit | profile_edit.jsp | 资料编辑页 |
| /app/follows | follow_list.jsp | 关注/粉丝列表 |
| /app/search | search.jsp | 搜索结果页 |
| /app/create-post | create_post.jsp | 发布动态页 |
| /app/admin | admin/*.jsp | 管理后台 |

### 7.2 样式文件

| 文件 | 用途 |
|------|------|
| base.css | 全局基础样式 |
| feed.css | 动态流页面样式 |
| profile.css | 用户主页样式 |
| auth.css | 登录注册页面样式 |
| post.css | 动态详情页样式 |
| follow.css | 关注列表页样式 |
| admin.css | 管理后台样式 |

### 7.3 脚本文件

| 文件 | 用途 |
|------|------|
| api.js | API 请求封装 |
| feed.js | 动态流交互逻辑 |
| profile.js | 用户主页交互逻辑 |
| auth.js | 登录注册逻辑 |
| post.js | 动态详情页逻辑 |
| interactions.js | 点赞评论等交互 |
| follows.js | 关注相关逻辑 |
| upload.js | 文件上传逻辑 |
| admin.js | 管理后台逻辑 |

---

## 8. 安全规范

### 8.1 认证与授权

| 安全措施 | 实现方式 |
|---------|----------|
| 密码加密 | BCrypt 单向散列，工作因子 ≥ 12 |
| 会话管理 | HttpSession，服务端存储 |
| 权限控制 | AuthFilter 拦截未授权请求 |
| CORS 控制 | CorsFilter 配置允许的源 |

### 8.2 API 访问控制

| 接口类型 | 访问控制 |
|---------|----------|
| 公开读取接口 | 无需认证（GET 类接口） |
| 用户操作接口 | 需要登录（Session 中存在 userId） |
| 管理员接口 | 需要 ADMIN 角色 |

### 8.3 数据安全

| 安全措施 | 说明 |
|---------|------|
| SQL 注入防护 | 使用 PreparedStatement 参数化查询 |
| XSS 防护 | JSP 使用 fn:escapeXml 转义输出 |
| 敏感信息保护 | 响应中不返回密码等敏感字段 |

---

## 9. 性能要求

### 9.1 响应时间

| 操作类型 | 目标响应时间 |
|---------|-------------|
| 页面加载 | < 3 秒 |
| API 请求 | < 500 毫秒 |
| 文件上传 | 取决于文件大小和网络 |

### 9.2 并发能力

| 指标 | 要求 |
|------|------|
| 数据库连接池 | 最大 10 连接（可配置） |
| 同时在线用户 | 支持 100+ |

### 9.3 分页规范

| 参数 | 默认值 | 最大值 |
|------|--------|--------|
| limit | 20 | 50 |

---

## 10. 部署规范

### 10.1 环境要求

| 组件 | 版本要求 |
|------|---------|
| JDK | 17 或更高 |
| MySQL | 8.0 或更高 |
| Tomcat | 9.0 或更高 |

### 10.2 配置文件

配置文件路径: `src/main/resources/application.properties`

| 配置项 | 说明 |
|--------|------|
| db.url | 数据库连接 URL |
| db.user | 数据库用户名 |
| db.password | 数据库密码 |
| db.pool.max | 连接池最大连接数 |
| file.storage.path | 文件存储根目录 |
| upload.maxFileSize | 单文件最大大小 |
| upload.maxRequestSize | 请求最大大小 |
| bcrypt.workFactor | 密码加密工作因子 |

### 10.3 数据库初始化

执行 `src/main/resources/db/schema.sql` 完成数据库表结构创建。

### 10.4 目录结构

```
项目根目录/
├── src/
│   ├── main/
│   │   ├── java/com/micro/     # Java 源代码
│   │   ├── resources/           # 配置文件
│   │   └── webapp/              # Web 资源
│   │       ├── static/          # 静态资源
│   │       │   ├── css/         # 样式文件
│   │       │   ├── js/          # 脚本文件
│   │       │   └── uploads/     # 用户上传文件
│   │       └── WEB-INF/
│   │           ├── jsp/         # JSP 页面
│   │           └── web.xml      # Web 配置
│   └── test/                    # 测试代码
├── document/                    # 项目文档
├── pom.xml                      # Maven 配置
└── README.md                    # 项目说明
```

---

## 附录

### A. 错误码定义

| 错误码 | 含义 |
|--------|------|
| 4001 | 缺少必填参数 |
| 4002 | 参数格式错误 |
| 4007 | 无效的 ID |
| 4009 | 业务规则冲突 |
| 4010 | 参数校验失败 |
| 4011 | 凭证无效 |
| 4013 | 需要登录 |
| 4014 | 登录已过期 |
| 4017 | 需要认证 |
| 4030 | 权限不足 |
| 4035 | 仅管理员可访问 |
| 4040 | 用户不存在 |
| 4042 | 动态不存在 |
| 4043 | 操作失败 |
| 5001 | 文件缺失 |
| 5002 | 文件类型不支持 |

### B. 媒体元数据 JSON 格式

```json
[
  {
    "id": 1,
    "path": "2025/12/uuid-filename.jpg",
    "type": "IMAGE",
    "size": 102400
  }
]
```

---

**文档结束**
