
# 前端需求书 — MicroForum

> 关键变更：**前端使用 JSP（位于 `webapp/WEB-INF/jsp/`）而非纯 HTML**。JSP 用于服务端渲染页面框架与首次页面加载，交互采用 AJAX（Fetch）请求后端 `/api/*` JSON 接口。

## 一、总体技术
- **模板**：JSP + JSTL (核心标签库)、EL 表达式
- **静态资源**：`webapp/static/`（css, js, images）
- **脚本与库**：原生 JS + 可选使用 jQuery (轻量)；建议用原生 Fetch + 小工具库。
- **前端目录（详细）**
```
webapp/
  WEB-INF/
    jsp/
      layout/
        header.jsp
        footer.jsp
        nav.jsp
      index.jsp
      feed.jsp
      profile.jsp
      post.jsp
      create_post.jsp
      login.jsp
      register.jsp
      admin/
        dashboard.jsp
  static/
    css/
      base.css
      feed.css
      post.css
    js/
      api.js
      auth.js
      feed.js
      post.js
    uploads/  (软链接到 file.storage.path 或通过 servlet 提供访问)
```

## 二、全局样式规范（精确到字体/间距）
- **全局字体**
  - `font-family: "Inter", system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;`
  - `html { font-size: 16px; }`
- **标题**
  - `h1 { font-size: 28px; line-height: 36px; }`
  - `h2 { font-size: 22px; line-height: 30px; }`
  - `h3 { font-size: 18px; line-height: 26px; }`
- **正文**
  - `p, .text { font-size: 14px; line-height: 22px; }`
  - `.muted { font-size: 12px; color: #6B7280; }`
- **布局单位**
  - 基础间距 8px；常用边距：8/16/24/32px
- **容器**
  - 页面最大宽度 `max-width: 1200px; margin: 0 auto;`
  - 主栏 `.main { width: 720px; }` 侧栏 `.aside { width: 320px; }`
- **卡片**
  - padding: 16px; margin-bottom: 16px; border-radius: 8px; box-shadow: 0 1px 4px rgba(0,0,0,0.06)

## 三、JSP 页面逐条细化（DOM 结构 + 交互 + API）

### 1) `WEB-INF/jsp/layout/header.jsp`
- 内容：LOGO、搜索表单（`<form action="/search">`）、右侧用户菜单（头像/下拉）
- 高度：64px；LOGO 左对齐，搜索居中，右侧用户信息对齐
- 引入 `static/css/base.css` 与 `static/js/api.js`

### 2) `WEB-INF/jsp/index.jsp` -> 重定向到 `feed.jsp` 或展示简短路由
- 包含 `header.jsp`、`footer.jsp`
- 使用 JSTL 在服务端填充少量用户初始信息（若 session 存在）

### 3) `WEB-INF/jsp/feed.jsp`
- **用途**：时间线（卡片列表）
- **结构**
  - `<div class="container">`
    - `<aside class="aside">` 推荐/热搜
    - `<main class="main">` 卡片列表（`<div id="feed-list"></div>`）加载逻辑由 `static/js/feed.js` 控制
  - `</div>`
- **初始渲染**：JSP 可渲染第一页 `feed`（通过 Servlet 将第一页数据放入 request attribute），用于 SEO 与首屏渲染
- **分页**：JS 使用 `IntersectionObserver` 加载更多：调用 `/api/posts?feed=true&offset=X&limit=Y` 并以 JSON 加载渲染卡片模板（使用 JS 模板字符串）

### 4) `WEB-INF/jsp/create_post.jsp`
- **表单元素**
  - `<textarea id="contentText">`（min-height:120px, font-size:16px）
  - 媒体上传区 `<input type="file" multiple accept="image/*,video/*">` + 拖拽区域
  - 预览区：显示缩略图或 poster
  - 提交按钮 `button#publish`（height:40px, border-radius:8px）
- **上传流程（前端）**
  1. 用户选择文件 -> `upload.js` 逐个上传到 `/api/media/upload`（multipart），获取 `path` 列表
  2. 收到 mediaMeta 后在隐藏字段中保存 JSON
  3. 提交表单 -> POST `/api/posts`（Content-Type: application/json，Fetch）
- **交互提示**：上传进度显示条（每个文件）

### 5) `WEB-INF/jsp/post.jsp`（单帖）
- 服务端通过 Servlet 填充完整 Post 对象到 request scope（用于首屏渲染）
- 页面元素：大尺寸媒体展示区（轮播）、正文、操作栏（点赞/评论/转发）、评论区（由 JS 以 AJAX 加载并提交）
- 评论提交：POST `/api/comments`，返回新评论并在页面顶部追加

### 6) `WEB-INF/jsp/profile.jsp`
- 顶部：背景横幅（可上传）、头像 96px 圆形、displayName 20px、@username 14px
- 帖子显示：支持切换视图（列表/网格），网格每项 240px
- Follow 按钮：48px 高，蓝色主按钮

### 7) `WEB-INF/jsp/admin/dashboard.jsp`
- 管理列表表格（用户/帖子）：表格行高 48px，分页 50/页
- 操作按钮（删除/封禁）使用 confirm 弹窗并调用 `/api/admin/*`

## 四、JSP 渲染与 AJAX 协作模式（规范）
- **模式一（首次渲染）**：Servlet 在 GET 请求时查询第一页数据，放入 `request.setAttribute("feedList", feedList)`，转发 `request.getRequestDispatcher("/WEB-INF/jsp/feed.jsp").forward(request, response);`。页面载入时展示首屏数据。
- **模式二（动态交互）**：后续分页、点赞、评论使用 AJAX（Fetch）调用 `/api/*` 接口，返回 JSON，前端动态更新 DOM。

## 五、静态资源访问与上传
- 所有用户上传文件保存到 `file.storage.path`，并通过 `MediaServlet` 或映射路径 `/static/uploads/*` 提供访问。
- JSP 中图片引用使用 `${pageContext.request.contextPath}/static/uploads/2025/...` 或 MediaServlet 提供的访问 URL。

## 六、前端 JS 设计（模块）
- `static/js/api.js`：封装 `apiGet`, `apiPost`, `apiFetchJson`，均带 `credentials: 'include'`
- `static/js/auth.js`：登录/登出小工具
- `static/js/upload.js`：文件上传（multipart + progress）
- `static/js/feed.js`：feed 渲染逻辑（模板生成 DOM）
- `static/js/post.js`：post 详情页面逻辑（轮播、评论交互）

## 七、可访问性与 SEO
- JSP 模板要输出语义化标签（article, header, nav）
- 图片含 `alt`，按钮含 `aria-label`
- 页面 meta、Open Graph 标签（方便分享时显示）

## 八、样式表细节（示例 snippet）
```css
html { font-size:16px; font-family: "Inter", system-ui, -apple-system, "Segoe UI", Roboto, Arial; }
.container { max-width:1200px; margin:0 auto; display:flex; gap:24px; padding:16px; }
.main { width:720px; }
.aside { width:320px; }
.card { background:#fff; padding:16px; border-radius:8px; box-shadow:0 1px 4px rgba(0,0,0,0.06); margin-bottom:16px; }
.avatar { width:48px; height:48px; border-radius:50%; }
```

## 九、示例 JSP 与 Servlet 配合（feed）
- `FeedServlet` (GET `/feed`)：
  1. 读取 `offset=0 limit=20`，调用 `postService.getFeed(...)`
  2. `request.setAttribute("feedList", feedList)`
  3. `request.getRequestDispatcher("/WEB-INF/jsp/feed.jsp").forward(request,response);`
- `feed.jsp` 使用 JSTL 遍历 `feedList` 渲染卡片，并在页面底部加载 `static/js/feed.js` 负责后续分页。

## 十、前端测试
- 手动测试：Chrome 开发者工具模拟手机、慢网速
- 自动化：可使用 Selenium 或 Playwright 对关键流程（发布、点赞、评论）做回归测试

